    <!DOCTYPE html>
     <html>

    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
        <meta http-equiv="Content-Security-Policy" content="default-src * gap: data: 'unsafe-eval' 'unsafe-inline' blob: ws: https://ssl.gstatic.com;img-src * data: gap: blob: 'self' content:;frame-src * gap: blob:;connect-src * gap: data: 'unsafe-eval' 'unsafe-inline' blob:;style-src * 'self' 'unsafe-inline' 'unsafe-eval' data: blob:;media-src *;script-src * data: 'self' 'unsafe-inline' 'unsafe-eval' gap: blob:;" />

		<link rel="stylesheet" href="css/font.awesome.css" />
		<link rel="stylesheet" href="css/jquery.mobile.css" />
		<link rel="stylesheet" href="css/waves.min.css" />
		<link rel="stylesheet" href="css/animate.css" />
		<link rel="stylesheet" href="css/nativedroid2.css" />

        <!--
        this FINALLY works:
        note that gap: is very important for ios
        and 'unsafe-inline' is very important for onclick, etc.
        MAJOR hassle

        <meta http-equiv="Content-Security-Policy" content="default-src * gap: data: 'unsafe-eval' 'unsafe-inline' blob:; img-src * data: gap: blob:; frame-src * gap: blob:; connect-src * gap: data: 'unsafe-eval' 'unsafe-inline' blob: ;style-src * 'self' 'unsafe-inline' 'unsafe-eval'; media-src *; script-src * data: 'self' 'unsafe-inline' 'unsafe-eval' gap: blob:; ">

        -->
        
        <!--<meta http-equiv="Content-Security-Policy" content="default-src * gap: ws: https://ssl.gstatic.com;img-src * 'self' data: content:;style-src 'self' 'unsafe-inline' data: blob:;script-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">-->



		<script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript" src="js/jquery.js"></script>

		<script type="text/javascript" xsrc="js/jquery-ui.js"></script>
		<script type="text/javascript" src="js/mustache.js"></script>
		<script type="text/javascript" src="js/moment.js"></script>
		<script src="js/jquery.mobile.js"></script>
		<script src="js/waves.min.js"></script>
		<script src="js/wow.min.js"></script>
		<script src="js/nativedroid2.js"></script>
		<script type="text/javascript" src="js/app.js"></script>
		<script type="text/javascript" src="js/observing.js"></script>
		<script type="text/javascript">

		document.addEventListener('deviceready', function() {
            //start-up code in here...
            $.support.cors = true;
			$.mobile.allowCrossDomainPages = true;	
			$.mobile.hashListeningEnabled = false;
			$.mobile.pushStateEnabled = false;
			$.mobile.changePage.defaults.changeHash = false;


			$( window ).on( "navigate", function( event, data ) {
				console.log( data.state.info );
				console.log( data.state.direction )
				console.log( data.state.url )
				console.log( data.state.hash )
			});

			app.settings.load();
			app.settings.scatter();
			app.observation.initialize();

			
		}, false);

		
		$(function() {			
			//need to explicitly activate these since they are outside of a page
			$("body>[data-role='panel']" ).panel( {beforeopen: function(ev, ui) {
					//this is the chance to refresh the counts
					$(this).find(".ui-li-count").each(function() {
						$(this).html(app.observation[$(this).attr("for")].count());
					});
				}
			});

			$("body>[data-role='panel'] ul[data-role='listview']").listview();

			//load up the categories
			$.get("data/categories.json", null, function(res) {
				observing.categories = res;
				var template = $("#category-block-template").html();
				Mustache.parse(template);

				var groups = {
					NATURAL:[],
					HUMAN:[],
					EVENT:[]
				}
				for (var i = 0; i < res.length; i++) {
					if(res[i].GroupID && res[i].GroupID != null)
					{
						var h = Mustache.render(template, res[i]);
						groups[res[i].GroupID].push(h);
					}
				};

				$("#categories_NATURAL").html(groups.NATURAL.join(""));
				$("#categories_EVENT").html(groups.EVENT.join(""));
				$("#categories_HUMAN").html(groups.HUMAN.join(""));

				for (var i = 0; i < res.length; i++) {
					//this is important for getting it to scale properly
					$("#categoryblock-" + res[i].CategoryID).find("svg").attr("width", "60").attr("height", "60");
				};
			}, "json");
		})

		</script>

		<style>
			.category-block svg {
				max-width: 50px;
			}

			.category-block {
				display: inline-block;
				width:100px;
				height:100px;
				border:4px solid silver;
				border-radius: 4px;
				text-align: center;
				margin:5px;
				margin-bottom: 10px;
				vertical-align: bottom;
				background-color:white;
			}

			.selected {
				border-color:#4CAF50;
				background-color: rgba(139, 195, 74, 0.486);
			}

			.category-block div {
				overflow: hidden;
				text-overflow: ellipsis;
				height:32px;
				font-size:80%;
			}

			.nonefound {
				color:silver;
				font-style: italic;
				margin-top:20px;
				margin-bottom: 20px;
				text-align: center;
			}
		</style>
    <title>LEO Field Reporter</title>
</head>

<script>
	function toggleChecked(el) {
		$(el).toggleClass("selected");
		event.preventDefault();
		$(el).trigger("change");
	}
</script>

<!--mustache templates-->
<script id="category-block-template" type="template/mustache">
	<div class="category-block" onclick="toggleChecked(this);" id="categoryblock-{{CategoryID}}" category="{{CategoryID}}">
		{{{IconSvg}}}
		<div>{{CategoryName}}</div>
	</div>
</script>

<script id="photo-thumbnail-template" type="template/mustache">
	<div class="photo-thumbnail" index="{{Index}}">
		<img style="width:100%;" src="{{Data}}" />
		<div><input type="text" placeholder="Caption" value="{{Caption}}"/></div>
		<div><a class="ui-btn ui-btn-icon-left clr-btn-red" href="app.removePhoto({{Index}});"><i class="zmdi zmdi-delete"></i> Remove</a></div>
	</div>
</script>

<script id="drafts-template" type="template/mustache">
	<ul>
		{{#drafts}}
			<li>
				<a href="javascript:app.showPage('observation');app.observation.drafts.edit('{{_ID}}');">
					<h2>{{ObservationTitle}}{{^ObservationTitle}}Untitled Observation{{/ObservationTitle}}</h2>
					<p>Updated {{_UPDATED}}</p>
					<span class="ui-li-count">{{_STATUS}}</span>
				</a>
			</li>
		{{/drafts}}
	</ul>
</script>

<script id="outbox-template" type="template/mustache">
	<ul>
		{{#drafts}}
			<li>
				<a href="javascript:app.observation.outbox.edit('{{_ID}}');">
					<h2>{{ObservationTitle}}{{^ObservationTitle}}Untitled Observation{{/ObservationTitle}}</h2>
					<p>Updated {{_UPDATED}}</p>
					<span class="ui-li-count">{{_STATUS}}</span>
				</a>
			</li>
		{{/drafts}}
	</ul>
</script>

<body class="clr-accent-blue">

	

	<div data-role="page" id="home">

		<nd2-include data-src="header.html"></nd2-include>
	
		<div role="main" class="ui-content">
			<p>home page</p>
		</div>
	
	</div><!-- /page -->

	<script>
		
	</script>

	<div data-role="page" id="observation">

		<!--custom header for this page only-->
		<div data-role="header" data-position="fixed" class="wow fadeIn" data-tap-toggle="false">
			<a href="#editingoptions" id="editingOptionsButton" class="ui-btn ui-btn-right wow fadeIn" data-wow-delay='1.2s'><i class="zmdi zmdi-more-vert"></i></a>
			<a href="#leftpanel" class="ui-btn ui-btn-left wow fadeIn" data-wow-delay='0.8s'><i class="zmdi zmdi-menu"></i></a>
			<h1 class="wow fadeIn" data-wow-delay='0.4s'><img src="img/logo.png" style="max-width:30px;vertical-align: middle;" /> Field Reporter</h1>
		</div>
	
		<div role="main" class="ui-content">
			<div id="current-observation-title" style="color:gray;"></div>

			<div id="continue-page" class="observation-page" style="display:none;">
				<h3>You have an unsaved draft. Do you want to continue editing it?</h3>

				<div>
					<button type="button" onclick="app.observation.continueEditing();" class="ui-btn ui-btn-icon-right clr-btn-green" >
						Continue Editing
						<i class="zmdi zmdi-chevron-right"></i>
					</button>
					<button type="button" onclick="app.observation.startOver();" class="ui-btn  ui-btn-icon-left " >
						<i class="zmdi zmdi-refresh"></i>
						Start Over
					</button>
				</div>
			</div>

			<div id="headline-page" class="observation-page">
				<h3>What's your headline?</h3>
				<h5>This will be the title of your post</h5>
				<input type="text" name="ObservationTitle" id="ObservationTitle" value="" />

				<div>
					<button type="button" onclick="app.observation.next();" class="ui-btn  clr-btn-green ui-btn-icon-right" >
						Next
						<i class="zmdi zmdi-chevron-right"></i>
					</button>
				</div>
			</div>

			<div id="date-page" class="observation-page" style="display: none;">
				<h3>When did you make your observation?</h3>
				<input type="date" name="ObservationDate" id="ObservationDate" value="" />

				<div>
					<button type="button" onclick="app.observation.next();" class="ui-btn  clr-btn-green ui-btn-icon-right" >
						Next
						<i class="zmdi zmdi-chevron-right"></i>
					</button>

					<button type="button" onclick="app.observation.previous();" class="ui-btn  ui-btn-icon-left" >
							<i class="zmdi zmdi-chevron-left"></i>
						Previous</button>
				</div>
			</div>

			<div id="text-page" class="observation-page" style="display: none;">
				<h3>Please describe your observation</h3>
				<h5>Why is it unusual or significant?</h5>
				<textarea rows="10" style="min-height: 100px;" name="ObservationText" id="ObservationText"></textarea>

				<div>
					<button type="button" onclick="app.observation.next();" class="ui-btn  clr-btn-green ui-btn-icon-right" >
						Next
						<i class="zmdi zmdi-chevron-right"></i>
					</button>

					<button type="button" onclick="app.observation.previous();" class="ui-btn  ui-btn-icon-left" >
							<i class="zmdi zmdi-chevron-left"></i>
						Previous</button>
				</div>
			</div>

			<div id="photos-page" class="observation-page" style="display: none;">
				<h3>Add photos or videos to support your observation</label>
				
					<div>
						<button type="button" onclick="app.observation.photos.add();" class="ui-btn ui-icon-camera ui-btn-icon-left ui-btn-inline">Take Photo/Video</button>
						<button type="button" onclick="" class="ui-btn ui-icon-plus ui-btn-icon-left ui-btn-inline">Choose Photo/Video</button>
					</div>

					<div id="photo-thumbnails">

					</div>
				<div>
					<button type="button" onclick="app.observation.next();" class="ui-btn  clr-btn-green ui-btn-icon-right" >
						Next
						<i class="zmdi zmdi-chevron-right"></i>
					</button>

					<button type="button" onclick="app.observation.previous();" class="ui-btn  ui-btn-icon-left" >
							<i class="zmdi zmdi-chevron-left"></i>
						Previous</button>
				</div>
			</div>

			<div id="categories-page" class="observation-page" style="display: none;">
				<h5>Please help us categorize your observation</h5>
				
				<h3>Natural Environment</h3>
				<p>What aspects of the natural environment are relevant to this post? Choose all that apply.</p>


				<div id="categories_NATURAL"></div>
				

				<h3>Unusual or Unexpected Event</h3>
				<p>Why is this post unusual or unexpected? What about this event deviates from the norm?</p>

				<div id="categories_EVENT"></div>

				<h3>Impact on Human Environment</h3>
				<p>How has the human environment been impacted by the event described in this post?</p>

				<div id="categories_HUMAN"></div>

				<div>
					<button type="button" onclick="app.observation.next();" class="ui-btn  clr-btn-green ui-btn-icon-right" >
						Next
						<i class="zmdi zmdi-chevron-right"></i>
					</button>

					<button type="button" onclick="app.observation.previous();" class="ui-btn  ui-btn-icon-left" >
							<i class="zmdi zmdi-chevron-left"></i>
						Previous</button>
				</div>
			</div>

			<div id="finished-page" class="observation-page" style="display: none;">
				<h3>Finish Your Observation</h3>

				<div>
						<button type="button" onclick="app.observation.saveAsDraft();" class="ui-btn  clr-btn-green ui-btn-icon-left" >
							<i class="zmdi zmdi-save"></i>
							Save as Draft
						</button>
						<br>
						<button type="button" onclick="app.observation.drafts.send();" class="ui-btn  clr-btn-green ui-btn-icon-left" >
							<i class="zmdi zmdi-mail-send"></i>
							Send Now
						</button>
						<br>
						<button type="button" onclick="app.observation.previous();" class="ui-btn  ui-btn-icon-left" >
							<i class="zmdi zmdi-chevron-left"></i>
						Previous</button>
						<br>
						<button type="button" onclick="app.observation.abandon();" class="ui-btn  ui-btn-icon-left" >
							<i class="zmdi zmdi-delete"></i>
						Delete Observation</button>

					</div>
			</div>

			<div data-role="panel" id="editingoptions" class="ui-bottom-sheet ui-bottom-sheet-list" data-animate="false" data-position='bottom' data-display="overlay">
				<div class='row around-xs'>
					<div class='col-xs-auto'>
						<a href='javascript:app.observation.saveAsDraft();' class='ui-bottom-sheet-link ui-btn ui-btn-inline waves-effect waves-button waves-effect waves-button' data-ajax='false'><i class='zmdi zmdi-save zmd-2x'></i><strong>Save Draft</strong></a>
					</div>
					<div class='col-xs-auto'>
						<a href='javascript:app.observation.deleteDraft();' class='ui-bottom-sheet-link ui-btn ui-btn-inline waves-effect waves-button waves-effect waves-button' data-ajax='false'><i class='zmdi zmdi-delete zmd-2x'></i><strong>Delete Draft</strong></a>
					</div>
					<div class='col-xs-auto'>
							<a href='javascript:app.observation.dumpToConsole();' class='ui-bottom-sheet-link ui-btn ui-btn-inline waves-effect waves-button waves-effect waves-button' data-ajax='false'><strong>Dump to Console</strong></a>
						</div>
				</div>
			</div>

		</div>
	
		
	</div>

	<div data-role="page" id="drafts">

		<nd2-include data-src="header.html"></nd2-include>
	
		<div role="main" class="ui-content">
		</div>
	
	</div>

	<div data-role="page" id="outbox">

		<nd2-include data-src="header.html"></nd2-include>
	
		<div role="main" class="ui-content">
		</div>
	
	</div>

	<div data-role="page" id="sign-in">

			<nd2-include data-src="header.html"></nd2-include>
		
			<div role="main" class="ui-content">

				<h3>Sign In</h3>

				<label for="emailAddress">Email Address</label>
				<input type="email" name="LoginName" value="" data-clear-btn="true">
				<label for="password">Password</label>
				<input type="password" name="Password" value="" >

				<button class="ui-btn  clr-btn-green" onclick="app.doSignIn();">Sign In</button>
			</div>
		
		</div>
	
	<div data-role="page" id="settings">
	
		<nd2-include data-src="header.html"></nd2-include>
	
		<div role="main" class="ui-content">		
			<label>Language</label>
			<select name="Language">
				<option value="en">English</option>
				<option value="es">Español</option>
				<option value="fr">Français</option>
			</select>
			
			<br>

			<label>Root URL</label>
			<input type="url" name="RootUrl" value="">

			<div>
				<button onclick="app.settings.gather();app.notify('Saved settings.');" class="ui-btn">Save Settings</button>
			</div>

		</div>
	
	</div>

	<div data-role="page" id="about">
	
			<nd2-include data-src="header.html"></nd2-include>
		
			<div role="main" class="ui-content">
				<h3>About the Local Environmental Observer Network</h3>
				<p>LEO is a network of local observers and topic experts who share knowledge about unusual animal, environment, and weather events. With LEO, you can connect with others in your community, share observations, raise awareness, and find answers about significant environmental events. You can also engage with topic experts in many different organizations and become part of a broader observer community.</p>

				<p><a href="#" onclick="window.open('https://www.leonetwork.org', '_system'); return false;">Visit us at leonetwork.org</a></p>

				<h3>About the LEO Field Reporter App</h3>

				<p>The LEO Field Reporter app is the easiest way to contribute to the LEO Network. It is designed to work without a network connection, so it's usable wherever you are witnessing unusual environmental events.</p>

			</div>
		
		</div>
  
	<!--menu-->
	<div data-role="panel" id="leftpanel" data-display="overlay" data-position-fixed="true" data-theme="a" >
			<div style="text-align:center;">
				<a href="javascript:app.showPage('home');"><img src="img/logo.png" /></a>
				<h3>Local Environmental Observer Network</h3>
			</div>
			
			<hr/>

			<ul data-role="listview" data-icon="false">
				<li><a href="javascript:app.showPage('observation');app.observation.start();">Make an Observation</a></li>
				<li><a href="javascript:app.showPage('drafts');">Drafts <span class="ui-li-count" for="drafts"></span></a></li>
				<li><a href="javascript:app.showPage('outbox');">Outbox <span class="ui-li-count" for="outbox"></span></a></li>
				<li><a href="javascript:app.showPage('sent');">Sent <span class="ui-li-count" for="sent"></span></a></li>
			</ul>
			<hr/>
			<ul data-role="listview" data-icon="false">
				<li><a href="javascript:app.showPage('about');">About</a></li>
				<li><a href="javascript:app.showPage('settings');">Settings</a></li>
			</ul>

	</div>
</body>

</html>